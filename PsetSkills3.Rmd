---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(tibble)
library(dplyr)
library(ggplot2)
library(dslabs)
library(scales)

install.packages("QuantPsyc")
install.packages("MASS")
install.packages("data.table")
install.packages("tidyr")
install.packages("GGally")

library(QuantPsyc)
library(MASS)
library(data.table)
library(tidyr)
library(GGally)


```


1
glimpse(gapminder)

1.a

```{r}
gapminder%>%
  arrange(country)%>%
  select(country, year,gdp)%>%
  mutate(previous_year_gdp= lag(gdp, order_by = country))
```



1.b



```{r}
gapminder%>%
  select(continent, year,gdp)%>%
  group_by(continent, year) %>%
  summarise_at(vars(gdp),sum,na.rm=TRUE)%>%
  mutate(previous_year_gdp= lag(gdp))%>%
  mutate(change=(gdp/previous_year_gdp-1))
```




```{r}

glimpse(gapminder)

gapminder%>%
  select(continent, year,gdp)%>%
  group_by(continent, year) %>%
  summarise_at(vars(gdp),sum,na.rm=TRUE)%>%
  mutate(previous_year_gdp= lag(gdp))%>%
  mutate(change=(gdp/previous_year_gdp-1))%>%
  ggplot(aes(x=year,y=change,group=continent,color=continent))+
  geom_line()+
  scale_y_continuous(name="Annual GDP change", limits=c(-0.05,0.1))
```
1.1.2

```{r}
gapminder %>%
  arrange(country)%>%
  select(country, year,gdp,region)%>%
  mutate(py_gdp = lag(gdp))%>%
  mutate(growth=gdp/py_gdp-1)%>%
  group_by(region)%>%
  mutate(mgr=mean(growth,na.rm=TRUE))%>%
  mutate(diff = growth-mgr )%>%
  arrange(diff)
```
1.1.3


```{r}
gapminder %>%
  select(country, year,gdp,region)%>%
  group_by(country)%>%
  mutate(py_gdp = lag(gdp))%>%
  mutate(growth=gdp/py_gdp-1,na.rm=TRUE)%>%
  group_by(region)%>%
  mutate(mgr=mean(growth,na.rm=TRUE))%>%
  mutate(bool_var = growth>mgr,na.rm=TRUE)%>%
  group_by(country)%>%
  summarise(summa=sum(bool_var,na.rm = TRUE))%>%
  arrange(desc(summa))



```
1.2.1

1.2.1.1.a&b

```{r}
gapminder%>%
  filter(country=='China')

  ggplot(gapminder, aes(x=infant_mortality))+
  geom_histogram(binwidth = 3)
              
```
1.2.1.2.a
```{r}

  ggplot(gapminder, aes(x=life_expectancy))+
  geom_histogram(binwidth = 3)
              
```
1.2.1.2.b
```{r}
gapminder %>%
  select(country, year,life_expectancy)%>%
  group_by(country,year)%>%
  mutate(bool_var = life_expectancy<40,na.rm=TRUE)%>%
  group_by(country)%>%
  summarise(summa=sum(bool_var,na.rm = TRUE))%>%
  arrange(desc(summa))%>%
  mutate(n1=sum(summa,na.rm=TRUE))
```
```{r}
gapminder %>%
  select(country, year,life_expectancy)%>%
  group_by(country,year)%>%
  mutate(bool_var = life_expectancy>80,na.rm=TRUE)%>%
  group_by(country)%>%
  summarise(summa=sum(bool_var,na.rm = TRUE))%>%
  arrange(desc(summa))%>%
  mutate(n1=sum(summa))
```

1.2.1.3

1.2.1.2.a

You probably want to use coord_cartesian instead of lims. Unexpected things can happen when you're fiddling around with the limits on histograms, because a fair bit of fiddly transformations have to happen to get from your raw data to the actual histogram.

So now you're wondering, how the heck did that happen, right?

Well, when you tell ggplot that you want 10 bins and the x limits go from 86 to 195, the histogram algorithm tries to create ten bins that span that actual range. That's why it's trying to create bins down below 100 even though there's no data there.

And then further oddities can happen because the bars may extend past the nominal data range (the xmin and xmax values), since the bar widths will generally encompass a little above and a little below your actual data at the high and low ends.

coord_cartesian will adjust the x limits after all this processing has happened, so it bypasses all these little quirks.
```{r}

  ggplot(gapminder, aes(x=life_expectancy,na.rm=FALSE))+
  geom_histogram(binwidth = 1)+
    coord_cartesian(
      xlim = c(10,80),
      ylim = c(0,400),
      expand = TRUE,
      default = FALSE,
      clip = "on"
)

              
```
1.2.2.1

```{r}


  ggplot(gapminder, aes(x=life_expectancy,na.rm=FALSE))+
  geom_bar()+
    coord_cartesian(
      xlim = c(40,40.5),
      ylim = c(0,3),
      expand = TRUE,
      default = FALSE,
      clip = "on"
)
```
1.2.2.2
if you sum over a column with na result is na
if you take a mean over  a column with ne the result is na

you can fix by using (,na.rm=TRUE)


2.1

glimpse(diamonds)

